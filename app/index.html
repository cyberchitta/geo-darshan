<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cluster Animation Viewer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/georaster@1.6.0/dist/georaster.browser.bundle.min.js"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet@3.10.0/dist/georaster-layer-for-leaflet.min.js"></script>
    <link rel="stylesheet" href="css/viewer.css">
</head>

<body>
    <div class="viewer-container">
        <div class="main-content">
            <div id="map" class="map-container"></div>
            <div class="controls-panel">
                <div class="animation-controls">
                    <button id="step-back" class="control-btn" title="Step Back (←)">⏮</button>
                    <button id="play-pause" class="control-btn" title="Play/Pause (Space)">▶</button>
                    <button id="step-forward" class="control-btn" title="Step Forward (→)">⏭</button>
                    <div class="speed-control">
                        <label for="speed-slider">Speed:</label>
                        <input type="range" id="speed-slider" min="0.5" max="3" step="0.1" value="1">
                        <span id="speed-value">1.0x</span>
                    </div>
                </div>
                <div class="navigation-controls">
                    <label for="k-slider">K-value:</label>
                    <input type="range" id="k-slider" min="0" max="100" step="1" value="0">
                    <div class="k-display">
                        <span id="current-k">--</span> clusters
                    </div>
                </div>
                <div class="overlay-controls">
                    <label for="opacity-slider">Opacity:</label>
                    <input type="range" id="opacity-slider" min="0" max="1" step="0.1" value="0.8">
                    <span id="opacity-value">80%</span>
                </div>
            </div>
        </div>
        <div class="right-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" data-panel="legend">Legend</button>
                <button class="panel-tab" data-panel="data">Data</button>
            </div>
            <div class="panel-content">
                <div id="legend-panel" class="tab-panel">
                    <div class="legend-header">
                        <h3>Cluster Legend</h3>
                        <div class="legend-stats">
                            <span id="legend-progress">0 of 0 labeled</span>
                        </div>
                    </div>
                    <div class="legend-controls">
                        <button id="save-labels-btn" class="legend-btn">Save Labels</button>
                        <button id="load-labels-btn" class="legend-btn">Load Labels</button>
                        <input type="file" id="load-labels-input" accept=".json" style="display: none;">
                        <button id="clear-labels-btn" class="legend-btn secondary">Clear All</button>
                    </div>
                    <div id="legend-clusters" class="legend-clusters-container">
                        <div class="legend-placeholder">Load cluster data to see legend</div>
                    </div>
                </div>
                <div id="data-panel" class="tab-panel active">
                    <div class="data-header">
                        <h3>Data Management</h3>
                    </div>
                    <div class="data-controls">
                        <button id="load-data-btn">Select Data Folder</button>
                        <input type="file" id="file-input" webkitdirectory multiple style="display: none;">
                        <button id="clear-data-btn" class="data-btn secondary">Clear Data</button>
                    </div>
                    <div class="dataset-info">
                        <div class="dataset-info-header" id="dataset-info-toggle">
                            <h4>Dataset Info</h4>
                            <span class="collapse-chevron">▼</span>
                        </div>
                        <div class="dataset-info-content" id="dataset-info-content">
                            <div id="data-status">No data loaded</div>
                            <div id="data-bounds"></div>
                            <div id="data-shape"></div>
                        </div>
                    </div>
                    <div class="loading-info">
                        <div id="loading-progress"></div>
                        <div id="loading-status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading cluster data...</div>
        <div class="loading-progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
    </div>
    <script type="module">
        import { GeoRasterAdapter } from './js/raster-handler.js';
        import { DataLoader } from './js/data-loader.js';
        import { MapManager } from './js/map.js';
        import { AnimationController } from './js/animation.js';
        import { ClusterViewer } from './js/viewer.js';

        const rasterHandler = new GeoRasterAdapter();
        window.rasterHandler = rasterHandler;
        window.GeoRasterAdapter = GeoRasterAdapter;
    </script>
    <script type="module" src="js/viewer.js"></script>
</body>

</html>